before_script:
  # Report the versions of varioius software, to make diagnosing problems
  # easier:
  - ghc --version
  - cabal --version
  - capnp --version
  - stylish-haskell --version
  - hlint --version
  # Update the hackage databse:
  - cabal update
test:alltests:
  image: zenhack/haskell-capnp-ci
  script:
    - cabal new-build
      # Run the tests. Newer versions of cabal have a new-test subcommand, but
      # not the version in the docker container.
    - $(find dist-newstyle -type f -name simple-tests)
      # Linting:
    - ./hlint.sh
      # Run stylish-haskell, and fail if it changes anything:
    - ./format.sh
    - git diff --exit-code
